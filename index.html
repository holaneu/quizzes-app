<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizzes</title>
    <!-- loeads data (array of quizzes) accessible as window.quizzesData -->
    <script id="quizzes-data" src="quizzes-data.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Home Screen -->
    <section id="home-screen">
        <h2>Quizzes</h2>
        <ul id="quiz-list" class="card-list"></ul>
    </section>

    <!-- Quiz Detail Screen -->
    <section id="quiz-detail-screen" class="hidden">
        <div class="back-btn" onclick="navigateToScreen('home-screen')">← Back</div>
        <h2 id="quiz-title" class="screen-title"></h2>
        <div id="quiz-sub-title" class="screen-sub-title"></div>
        <div id="quiz-info">
          <div id="questions-count"></div>
          <div id="score"></div>
          <div id="progress"></div>
          <div id="hints-used"></div>
        </div>
        <div class="space"></div>
        <div id="question" class="section-title text-center"></div>
        <div id="options"></div>
        <div class="space"></div>
        <button id="hint-btn" class="btn btn-tertiary" onclick="showHint()">Show Hint</button>
        <div id="hint"></div>
        <div id="result"></div>
        <button id="next-btn" class="btn btn-primary" onclick="nextQuestion()" style="display:none;">Next Question</button>
    </section>

    <script>
        let quizzes = [];
        let currentQuestion = 0;
        let score = 0;
        let hintsUsed = 0;
        let progress = [];
        let currentQuiz = null;

        // Universal function to navigate between screens
        function navigateToScreen(screenId) {
            // Hide all sections
            const sections = document.querySelectorAll('section');
            sections.forEach(section => section.classList.add('hidden'));

            // Show the targeted screen
            document.getElementById(screenId).classList.remove('hidden');
        }

        // Fetch quiz data from external JSON file
        function fetchQuizData() {
            /*fetch('quizzes.json')
                .then(response => response.json())
                .then(data => {
                    quizzes = data;
                    loadQuizList();
                })
                .catch(error => console.error('Error loading quiz data:', error));
                */
          quizzes = jsFileQuizzesData;
          loadQuizList();
        }

        // Load quiz list on the home screen
        function loadQuizList() {
            const quizListElement = document.getElementById('quiz-list');
            quizListElement.innerHTML = '';
            quizzes.forEach((quiz, index) => {
                const quizItem = document.createElement('li');
                quizItem.innerHTML = `
                  <button class="card-item" onclick="startQuiz(${index})">                      
                      <div class="card-content">
                        <span class="card-title">${quiz.name}</span>
                        <span class="card-badge">${quiz.questions.length} questions</span>
                      </div>
                  </button>`;
                quizListElement.appendChild(quizItem);
            });
        }

        // Start selected quiz
        function startQuiz(quizIndex) {
            currentQuiz = quizzes[quizIndex];
            document.getElementById('quiz-title').textContent = currentQuiz.name;
            document.getElementById('questions-count').textContent = "Questions: " + currentQuiz.questions.length;
            resetQuiz();
            navigateToScreen('quiz-detail-screen');
            loadQuestion();
        }

        // Load current question
        function loadQuestion() {
            const q = currentQuiz.questions[currentQuestion];
            document.getElementById('question').textContent = q.question;
            const options = document.getElementById('options');
            options.innerHTML = '';
            q.options.forEach((option, i) => {
                options.innerHTML += `<button class="btn btn-primary" onclick="checkAnswer(${i})">${option}</button>`;
            });
            document.getElementById('hint').textContent = '';
            document.getElementById('result').textContent = '';
            document.getElementById('hint-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
        }

        // Check selected answer
        function checkAnswer(choice) {
            const q = currentQuiz.questions[currentQuestion];
            const resultDiv = document.getElementById('result');
            if (choice === q.answer) {
                resultDiv.innerHTML = `
                  <div class="msg-success">
                    Correct :-)
                    <div class="space"></div>
                  </div>
                `;
                score++;
                progress.push("✓");
            } else {
                resultDiv.innerHTML = `
                  <div class="msg-error">
                    Incorrect
                    <div class="space"></div>
                    The correct answer is:
                    <br>
                    ${q.options[q.answer]}
                    <div class="space"></div>
                  </div>
                `;
                progress.push("✗");
            }
            currentQuestionScored++;
            updateQuizInfo();
            document.getElementById('options').innerHTML = '';
            document.getElementById('hint-btn').style.display = 'none';
            document.getElementById('hint').textContent = '';
            //document.getElementById('hint').style.display = 'none';
            document.getElementById('next-btn').style.display = 'block';
        }

        // Show hint for the current question
        function showHint() {
            document.getElementById('hint').textContent = currentQuiz.questions[currentQuestion].hint;
            hintsUsed++;
            updateQuizInfo();
            document.getElementById('hint-btn').style.display = 'none';
        }

        // Load the next question
        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < currentQuiz.questions.length) {
                loadQuestion();
            } else {
                document.getElementById('question').textContent = "";
                document.getElementById('options').innerHTML = '';
                document.getElementById('hint-btn').style.display = 'none';
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('result').innerHTML = `
                  <div class="msg-success">Quiz completed!</div>
                  <div class="space"></div>
                  Final score: ${score}/${currentQuiz.questions.length}
                  <br>
                   ${(score / currentQuiz.questions.length) * 100} %
                `;
            }
        }

        function updateQuizInfo() {
            document.getElementById('score').textContent = `Score: ${score}/${currentQuestionScored}`;
            document.getElementById('progress').textContent = `Progress: ${progress.join(" ")}`;
            document.getElementById('hints-used').textContent = `Hints used: ${hintsUsed}`;
        }

        // Reset quiz state
        function resetQuiz() {
            currentQuestion = 0;
            currentQuestionScored = 0;
            score = 0;
            hintsUsed = 0;
            progress = [];
            updateQuizInfo();            
        }

        // Initialize the app by fetching quiz data
        fetchQuizData();
    </script>
</body>
</html>
